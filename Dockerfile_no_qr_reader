FROM python:3.11-alpine

WORKDIR /extract

COPY . .

ARG run_tests=true
ARG TARGETPLATFORM

RUN apk add nano \
    && if [[ "$TARGETARCH" == "arm64" ]]; then apk add zlib-dev jpeg-dev; fi \
    && pip install protobuf qrcode Pillow \
    && if [[ "$run_tests" == "true" ]]; then /extract/run_pytest.sh test_extract_otp_secret_keys_pytest.py -k "not qreader" --relaxed; else echo "Not running tests..."; fi

WORKDIR /files

ENTRYPOINT ["python", "/extract/extract_otp_secret_keys.py"]

LABEL org.opencontainers.image.source https://github.com/scito/extract_otp_secret_keys
